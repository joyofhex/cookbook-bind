# Generated by Chef for <%= node['fqdn'] %>
# Local modifications will be overwritten.
<% node['bind']['included_files'].each do |file| -%>
include "<%= "#{node['bind']['sysconfdir']}/#{file}" %>";
<% end -%>

<% unless node['bind']['server'].empty? %>
<% node['bind']['server'].each {|server_ip, options| %>
server <%= server_ip %> {
  <% options.each do |option| -%>
  <%= option %>
<% end -%>
};
<% } -%>
<% end -%>

<% @zones.uniq.each do |zone| -%>
zone "<%= zone %>" in {
  type <%= node['bind']['zonetype'] %>;
  <% if node['bind']['zonetype'] == "master" %> 
  file "<%= "#{node['bind']['sysconfdir']}/#{node['bind']['zonetype']}" %>/db.<%= zone %>";
  <% else %>
  file "<%= "#{node['bind']['sysconfdir']}" %>/slaves/db.<%= zone %>";
  masters { default; };  
  <% end %>
};

<% end -%>

<% if @forwardzones.count > 0 -%>
<% @forwardzones.uniq.each do |forwardzone| -%>
zone "<%= forwardzone %>" in {
  type forward;
  forwarders { <% node['bind']['forwarders'].each do |forwarder| %><%= forwarder %>; <% end %>};
  forward only;
};
<% end -%>
<% end -%>

zone "." IN {
  type hint;
  file "named.ca";
};
