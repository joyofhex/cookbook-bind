# Generated by Chef for <%= node['fqdn'] %>
# Local modifications will be overwritten.
<% unless node['bind']['included_files'].empty? %>
<% node['bind']['included_files'].each do |file| -%>
include "<%= "#{node['bind']['sysconfdir']}/#{file}" %>";
<% end -%>
<% end -%>

<% unless node['bind']['server'].empty? %>
<% node['bind']['server'].each {|server_ip, options| %>
server <%= server_ip %> {
  <% options.each do |option| -%>
  <%= option %>
<% end -%>
};
<% } -%>
<% end -%>

<% if node['bind']['zones']['allow_update'] %>
include "<%= node['bind']['rndc-key'] %>";
<% end %>

<% @zones.uniq.each do |zone| -%>
zone "<%= zone %>" in {
  type <%= node['bind']['zonetype'] %>;
  <% if node['bind']['zonetype'] == "master" %>
  file "<%= node['bind']['zonetype'] %>/db.<%= zone %>";
  <% if node['bind']['zones']['allow_update'] %>
  allow-update { key rndc-key; };
  <% end %>
  <% unless node['bind']['zones']['also_notify'].empty? %>
  also-notify {
    <% node['bind']['zones']['also_notify'].each do |notify| -%>
    <%= notify %>;
    <% end -%>
  };
  <% end %>
  <% else %>
  file "slaves/db.<%= zone %>";
  masters { default; };
  <% end %>
};

<% end -%>

<% if @forwardzones.count > 0 -%>
<% @forwardzones.uniq.each do |forwardzone| -%>
zone "<%= forwardzone %>" in {
  type forward;
  forwarders { <% node['bind']['forwarders'].each do |forwarder| %><%= forwarder %>; <% end %>};
  forward only;
};
<% end -%>
<% end -%>
